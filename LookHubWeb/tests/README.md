# Тесты для LookHub

Этот каталог содержит модульные тесты для проекта LookHub.

## Структура тестов

```
tests/
├── __init__.py
├── conftest.py              # Фикстуры и конфигурация pytest
├── test_domain_entities.py  # Тесты доменных сущностей
├── test_use_cases.py        # Тесты бизнес-логики (use cases)
├── test_api_routers.py      # Тесты API роутеров
├── test_utils.py            # Тесты утилит и вспомогательных функций
└── README.md               # Этот файл
```

## Запуск тестов

### Установка зависимостей для тестирования

```bash
pip install -r requirements-test.txt
```

### Запуск всех тестов

```bash
pytest
```

### Запуск тестов с подробным выводом

```bash
pytest -v
```

### Запуск тестов с покрытием кода

```bash
pytest --cov=app --cov-report=html
```

### Запуск конкретных тестов

```bash
# Тесты только для доменных сущностей
pytest tests/test_domain_entities.py

# Тесты только для API
pytest tests/test_api_routers.py

# Тесты с определенным маркером
pytest -m "asyncio"
```

## Типы тестов

### 1. Тесты доменных сущностей (`test_domain_entities.py`)

Тестируют:
- Валидацию данных в Pydantic моделях
- Обработку enum значений
- Преобразование URL изображений
- Конфигурацию моделей

### 2. Тесты бизнес-логики (`test_use_cases.py`)

Тестируют:
- CRUD операции для одежды и образов
- Добавление/удаление категорий одежды
- Управление изображениями
- Взаимодействие с репозиториями

### 3. Тесты API роутеров (`test_api_routers.py`)

Тестируют:
- HTTP эндпоинты
- Валидацию запросов
- Обработку ошибок
- Форматы ответов

### 4. Тесты утилит (`test_utils.py`)

Тестируют:
- Сохранение и удаление изображений
- Валидацию данных
- Обработку ошибок
- Производительность

## Фикстуры

Основные фикстуры определены в `conftest.py`:

- `mock_clothes_repository` - Мок репозитория для одежды
- `mock_looks_repository` - Мок репозитория для образов
- `clothes_use_case` - Use case для одежды с мок репозиторием
- `looks_use_case` - Use case для образов с мок репозиториями
- `sample_clothes_data` - Тестовые данные для одежды
- `sample_look_data` - Тестовые данные для образов
- `test_client` - FastAPI тестовый клиент

## Маркеры

- `@pytest.mark.asyncio` - Для асинхронных тестов
- `@pytest.mark.slow` - Для медленных тестов
- `@pytest.mark.integration` - Для интеграционных тестов
- `@pytest.mark.unit` - Для модульных тестов

## Покрытие кода

Для генерации отчета о покрытии:

```bash
pytest --cov=app --cov-report=html
```

Отчет будет создан в `htmlcov/index.html`

## Лучшие практики

1. **Именование тестов**: Используйте описательные имена для тестов
2. **AAA паттерн**: Arrange, Act, Assert
3. **Изоляция тестов**: Каждый тест должен быть независимым
4. **Моки**: Используйте моки для внешних зависимостей
5. **Фикстуры**: Переиспользуйте фикстуры для общих данных

## Добавление новых тестов

1. Создайте новый файл `test_*.py`
2. Импортируйте необходимые модули
3. Используйте существующие фикстуры или создайте новые
4. Добавьте маркеры для категоризации тестов
5. Запустите тесты для проверки

## Отладка тестов

Для отладки конкретного теста:

```bash
pytest tests/test_use_cases.py::TestClothesUseCase::test_add_one_success -s -v
```

Флаг `-s` отключает захват вывода, `-v` включает подробный вывод. 